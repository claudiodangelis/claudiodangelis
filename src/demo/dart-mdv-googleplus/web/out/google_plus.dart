// Auto-generated from google_plus.html.
// DO NOT EDIT.

library google_plus_html;

import 'dart:html' as autogenerated_html;
import 'dart:web_audio' as autogenerated_audio;
import 'dart:svg' as autogenerated_svg;
import 'package:web_ui/web_ui.dart' as autogenerated;

import 'dart:html';

import 'dart:json';

import 'dart:isolate';

import 'package:js/js.dart' as js;

import 'package:web_ui/watcher.dart' as watchers;

import 'package:web_ui/safe_html.dart';


// Original code
final String CLIENT_ID = '688110452481.apps.googleusercontent.com';
final String SCOPE = 'https://www.googleapis.com/auth/plus.me';

ButtonElement authBtn = query('#authorize');

bool immediate = true;

String displayName = 'Me';
String tagline;
SafeHtml aboutMe;
String pic;

List<String> urls = [];

main(){

  js.scoped((){
    js.context.init = new js.Callback.once((){
      js.context.window.setTimeout(js.context.auth, 1);
      });
    
    js.context.auth = new js.Callback.many((){
      js.context.gapi.client.setApiKey('AIzaSyDOtMNdtbw17o9bs-kW7G6O3S05p0H8wYM');
      js.context.window.setTimeout(
        js.context.gapi.auth.authorize(js.map({
        'client_id':CLIENT_ID,
        'scope':SCOPE,
        'immediate':immediate
        }),
        js.context.onAuthResponse), 1
      );
    });


    js.context.onAuthResponse = new js.Callback.many((js.Proxy token){
      if(token!=null){
        authBtn.style.display='none';
        js.context.MakeRequest();
        immediate = true;
      }
      else{
        authBtn.style.display='block';
        immediate = false;
      }
    });

    js.context.MakeRequest = new js.Callback.once((){
      js.scoped((){
        js.context.gapi.client.load('plus', 'v1', new js.Callback.once((){
          var request = js.context.gapi.client.plus.people.get(
              js.map({
                'userId':'me',
                'fields':'aboutMe,circledByCount,displayName,image,tagline,urls/value'
              }));
          request.execute(js.context.RequestCallback);
        }));
      });
    });
    js.context.RequestCallback = new js.Callback.once((js.Proxy jsonResp, var rawResp){
      var data = JSON.parse(rawResp);

      for( var url in data[0]['result']['urls']){
        urls.add(url['value']);
      }
      displayName = data[0]['result']['displayName'];
      tagline = data[0]['result']['tagline'];
      pic = data[0]['result']['image']['url'];
      aboutMe = new SafeHtml.unsafe('<div>''${data[0]['result']['aboutMe']}</div>');
      
      watchers.dispatch();

    });
  });

  authBtn.on.click.add((Event e){
      js.scoped((){
        js.context.auth();
        });
      });

  ScriptElement script = new ScriptElement();
  script.src = "http://apis.google.com/js/client.js?onload=init";
  script.type = "text/javascript";
  document.body.children.add(script);
}


// Additional generated code
/** Create the views and bind them to models. */
void init_autogenerated() {
  var _root = autogenerated_html.document.body;
  autogenerated_html.Element __e1;
  
  var __binding0;
  
  List<autogenerated.WatcherDisposer> __stoppers1;
  
  autogenerated_html.Element __e5;
  
  autogenerated_html.Node _endPosition__e5;
  
  bool _isVisible__e5 = false;
  
  autogenerated_html.ParagraphElement __e4;
  
  autogenerated_html.Element __e3;
  
  var __binding2;
  
  List<autogenerated.WatcherDisposer> __stoppers2_1;
  
  autogenerated_html.ButtonElement __authorize;
  
  autogenerated_html.Element __e6;
  
  autogenerated_html.Node _endPosition__e6;
  
  bool _isVisible__e6 = false;
  
  autogenerated_html.ImageElement __pic;
  
  List<autogenerated.WatcherDisposer> __stoppers3_1;
  
  autogenerated_html.Element __e8;
  
  autogenerated_html.Node _endPosition__e8;
  
  bool _isVisible__e8 = false;
  
  autogenerated_html.DivElement __about;
  
  var __binding7;
  
  List<autogenerated.WatcherDisposer> __stoppers4_1;
  
  autogenerated_html.Element __e14;
  
  autogenerated_html.Node _endPosition__e14;
  
  bool _isVisible__e14 = false;
  
  autogenerated_html.UListElement __e13;
  
  autogenerated_html.Element __e12;
  
  List<autogenerated.WatcherDisposer> __stoppers5_1;
  
  List<Function> _removeChild__e12 = [];
  
  autogenerated_html.Node _endPosition__e12;
  


  // Initialize fields.
  __e1 = _root.query('#__e-1');
  __binding0 = new autogenerated_html.Text('');
  __stoppers1 = [];
  __e1.nodes.add(__binding0);
  __e1.nodes.add(new autogenerated_html.Text(' on Google+'));
  __e5 = _root.query('#__e-5');
  __authorize = _root.query('#authorize');
  __e6 = _root.query('#__e-6');
  __e8 = _root.query('#__e-8');
  __e14 = _root.query('#__e-14');
  

  // Attach model to views.
  __stoppers1.add(autogenerated.watchAndInvoke(() => '${ displayName }', (__e) {
    __binding0 = autogenerated.updateBinding( displayName , __binding0, __e.newValue);
  }));
  
  _endPosition__e5 = __e5;
  
  __stoppers1.add(autogenerated.watchAndInvoke(() => tagline != null, (__e) {
    bool showNow = __e.newValue;
    if (_isVisible__e5 && !showNow) {
      _isVisible__e5 = false;
      
      __e4 = null;
      __e3 = null;
      (__stoppers2_1..forEach((s) => s())).clear();
      __binding2 = null;
      
      _endPosition__e5 = autogenerated.removeNodes(__e5, _endPosition__e5);
      
    } else if (!_isVisible__e5 && showNow) {
      
      _isVisible__e5 = true;
      
      __e4 = new autogenerated_html.Element.html('<p><em id="__e-3"></em></p>');
      __e3 = __e4.query('#__e-3');
      __binding2 = new autogenerated_html.Text('');
      __stoppers2_1 = [];
      __e3.nodes.add(__binding2);
      
      autogenerated.insertAllBefore(__e5.parentNode, __e5.nextNode,
      
      [new autogenerated_html.Text('\n      '), __e4, _endPosition__e5 = new autogenerated_html.Text('\n    ')]);
      
      __stoppers2_1.add(autogenerated.watchAndInvoke(() => '${ tagline }', (__e) {
        __binding2 = autogenerated.updateBinding( tagline , __binding2, __e.newValue);
      }));
      
    }
  }));
  
  _endPosition__e6 = __e6;
  
  __stoppers1.add(autogenerated.watchAndInvoke(() => pic != null, (__e) {
    bool showNow = __e.newValue;
    if (_isVisible__e6 && !showNow) {
      _isVisible__e6 = false;
      
      (__stoppers3_1..forEach((s) => s())).clear();
      __pic = null;
      
      _endPosition__e6 = autogenerated.removeNodes(__e6, _endPosition__e6);
      
    } else if (!_isVisible__e6 && showNow) {
      
      _isVisible__e6 = true;
      
      __pic = new autogenerated_html.Element.html('<img id="pic">');
      __stoppers3_1 = [];
      
      autogenerated.insertAllBefore(__e6.parentNode, __e6.nextNode,
      
      [new autogenerated_html.Text('\n        '), __pic, _endPosition__e6 = new autogenerated_html.Text('\n      ')]);
      
      __stoppers3_1.add(autogenerated.watchAndInvoke(() =>  pic , (__e) { __pic.src = autogenerated.sanitizeUri(__e.newValue); }));
      
    }
  }));
  
  _endPosition__e8 = __e8;
  
  __stoppers1.add(autogenerated.watchAndInvoke(() => aboutMe != null, (__e) {
    bool showNow = __e.newValue;
    if (_isVisible__e8 && !showNow) {
      _isVisible__e8 = false;
      
      __about = null;
      (__stoppers4_1..forEach((s) => s())).clear();
      __binding7 = null;
      
      _endPosition__e8 = autogenerated.removeNodes(__e8, _endPosition__e8);
      
    } else if (!_isVisible__e8 && showNow) {
      
      _isVisible__e8 = true;
      
      __about = new autogenerated_html.Element.html('<div id="about"></div>');
      __binding7 = new autogenerated_html.Text('');
      __stoppers4_1 = [];
      __about.nodes.add(__binding7);
      
      autogenerated.insertAllBefore(__e8.parentNode, __e8.nextNode,
      
      [new autogenerated_html.Text('\n        '), __about, _endPosition__e8 = new autogenerated_html.Text('\n      ')]);
      
      __stoppers4_1.add(autogenerated.watchAndInvoke(() => '${ aboutMe }', (__e) {
        __binding7 = autogenerated.updateBinding( aboutMe , __binding7, __e.newValue);
      }));
      
    }
  }));
  
  _endPosition__e14 = __e14;
  
  __stoppers1.add(autogenerated.watchAndInvoke(() => urls.length != 0 , (__e) {
    bool showNow = __e.newValue;
    if (_isVisible__e14 && !showNow) {
      _isVisible__e14 = false;
      
      __e13 = null;
      (__stoppers5_1..forEach((s) => s())).clear();
      _endPosition__e12 = autogenerated.removeNodes(__e12, _endPosition__e12);
      for (var remover in _removeChild__e12) remover();
      _removeChild__e12.clear();
      
      __e12 = null;
      
      _endPosition__e14 = autogenerated.removeNodes(__e14, _endPosition__e14);
      
    } else if (!_isVisible__e14 && showNow) {
      
      _isVisible__e14 = true;
      
      __e13 = new autogenerated_html.Element.html('<ul>\n        <template id="__e-12" style="display:none"></template>\n      </ul>');
      __e12 = __e13.query('#__e-12');
      __stoppers5_1 = [];
      
      autogenerated.insertAllBefore(__e14.parentNode, __e14.nextNode,
      
      [new autogenerated_html.Text('\n      '), __e13, _endPosition__e14 = new autogenerated_html.Text('\n    ')]);
      
      _endPosition__e12 = __e12;
      __stoppers5_1.add(autogenerated.watchAndInvoke(() => urls, (_) {
        for (var remover in _removeChild__e12) remover();
        _removeChild__e12.clear();
        
        _endPosition__e12 = autogenerated.removeNodes(__e12, _endPosition__e12);
        var __insert___e12 = __e12.nextNode;
        for (var url in urls) {
          autogenerated_html.LIElement __e11;
          autogenerated_html.AnchorElement __e10;
          List<autogenerated.WatcherDisposer> __stoppers6_2_1;
          var __binding9;
          __e11 = new autogenerated_html.Element.html('<li><a id="__e-10"></a></li>');
          __e10 = __e11.query('#__e-10');
          __binding9 = new autogenerated_html.Text('');
          __e10.nodes.add(__binding9);
          __stoppers6_2_1 = [];
          autogenerated.insertAllBefore(__e12.parentNode, __insert___e12,
          [new autogenerated_html.Text('\n          '), __e11, _endPosition__e12 = new autogenerated_html.Text('\n        ')]);
          __stoppers6_2_1.add(autogenerated.watchAndInvoke(() =>  url , (__e) { __e10.href = autogenerated.sanitizeUri(__e.newValue); }));
          __stoppers6_2_1.add(autogenerated.watchAndInvoke(() => '${ url }', (__e) {
            __binding9 = autogenerated.updateBinding( url , __binding9, __e.newValue);
          }));
          _removeChild__e12.add(() {
            __e11 = null;
            (__stoppers6_2_1..forEach((s) => s())).clear();
            __e10 = null;
            __binding9 = null;
          });
        }
      }));
      
    }
  }));
  

}
